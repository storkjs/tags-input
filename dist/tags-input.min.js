Number.isInteger||(Number.isInteger=function(value){return"number"==typeof value&&isFinite(value)&&Math.floor(value)===value}),function(root){"use strict";var keyboardMap=["","","","CANCEL","","","HELP","","BACKSPACE","TAB","","","CLEAR","ENTER","ENTER_SPECIAL","","SHIFT","CONTROL","ALT","PAUSE","CAPS_LOCK","KANA","EISU","JUNJA","FINAL","HANJA","","ESCAPE","CONVERT","NONCONVERT","ACCEPT","MODECHANGE","SPACE","PAGE_UP","PAGE_DOWN","END","HOME","LEFT","UP","RIGHT","DOWN","SELECT","PRINT","EXECUTE","PRINTSCREEN","INSERT","DELETE","","0","1","2","3","4","5","6","7","8","9","COLON","SEMICOLON","LESS_THAN","EQUALS","GREATER_THAN","QUESTION_MARK","AT","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","OS_KEY","","CONTEXT_MENU","","SLEEP","NUMPAD0","NUMPAD1","NUMPAD2","NUMPAD3","NUMPAD4","NUMPAD5","NUMPAD6","NUMPAD7","NUMPAD8","NUMPAD9","MULTIPLY","ADD","SEPARATOR","SUBTRACT","DECIMAL","DIVIDE","F1","F2","F3","F4","F5","F6","F7","F8","F9","F10","F11","F12","F13","F14","F15","F16","F17","F18","F19","F20","F21","F22","F23","F24","","","","","","","","","NUM_LOCK","SCROLL_LOCK","WIN_OEM_FJ_JISHO","WIN_OEM_FJ_MASSHOU","WIN_OEM_FJ_TOUROKU","WIN_OEM_FJ_LOYA","WIN_OEM_FJ_ROYA","","","","","","","","","","CIRCUMFLEX","EXCLAMATION","DOUBLE_QUOTE","HASH","DOLLAR","PERCENT","AMPERSAND","UNDERSCORE","OPEN_PAREN","CLOSE_PAREN","ASTERISK","PLUS","PIPE","HYPHEN_MINUS","OPEN_CURLY_BRACKET","CLOSE_CURLY_BRACKET","TILDE","","","","","VOLUME_MUTE","VOLUME_DOWN","VOLUME_UP","","","SEMICOLON","EQUALS","COMMA","MINUS","PERIOD","SLASH","BACK_QUOTE","","","","","","","","","","","","","","","","","","","","","","","","","","","OPEN_BRACKET","BACK_SLASH","CLOSE_BRACKET","QUOTE","","META","ALTGR","","WIN_ICO_HELP","WIN_ICO_00","","WIN_ICO_CLEAR","","","WIN_OEM_RESET","WIN_OEM_JUMP","WIN_OEM_PA1","WIN_OEM_PA2","WIN_OEM_PA3","WIN_OEM_WSCTRL","WIN_OEM_CUSEL","WIN_OEM_ATTN","WIN_OEM_FINISH","WIN_OEM_COPY","WIN_OEM_AUTO","WIN_OEM_ENLW","WIN_OEM_BACKTAB","ATTN","CRSEL","EXSEL","EREOF","PLAY","ZOOM","","PA1","WIN_OEM_CLEAR",""],getPosition=function(elm){for(var xPos=0,yPos=0;elm;)xPos+=elm.offsetLeft,yPos+=elm.offsetTop,elm=elm.offsetParent;return{x:xPos,y:yPos}},getElementIndex=function(elm){for(var i=0;i<elm.parentNode.childNodes.length;i++)if(elm===elm.parentNode.childNodes[i])return i},storkTagsInput=function(options){this.tagsInput=options.element,this.suggestionsHandler=options.suggestionsHandler,this.rnd||(this.rnd=1e3*(Math.floor(9*Math.random())+1)+Date.now()%1e3),this.rechooseRemove=options.rechooseRemove||!1,this.chosenTagsFormat=options.chosenTagsFormat||"@@@ : ###",this.chosenTags=[],this.focusedTagIndex=null,this.lastSearchString="",this.tagDeleteThrottle={allowed:!0,TO:void 0},this.tagsInput.classList.add("stork-tags","stork-tags"+this.rnd),this.tagsInput.setAttribute("tabindex",0),this.buildDom(),this.setEventListeners(),this.updateWidths()};storkTagsInput.prototype.buildDom=function(){var ul=document.createElement("ul"),li=document.createElement("li"),input=document.createElement("input");li.classList.add("search"),li.appendChild(input),ul.appendChild(li),this.tagsInput.appendChild(ul);var dropdownContainer=document.createElement("div");dropdownContainer.classList.add("stork-tags-dropdown-container","stork-tags-dropdown-container"+this.rnd),dropdownContainer.setAttribute("tabindex",0),dropdownContainer.style.width=this.tagsInput.offsetWidth+"px";var xy=getPosition(this.tagsInput);dropdownContainer.style.left=xy.x+"px",dropdownContainer.style.top=xy.y+this.tagsInput.offsetHeight+1+"px",this.ul=ul,this.input=input,this.dropdownContainer=dropdownContainer,this.dropdownContainer.storkTagsProps={allLIs:this.dropdownContainer.getElementsByTagName("li"),hoveredLIIndex:null},document.body.appendChild(dropdownContainer)},storkTagsInput.prototype.setEventListeners=function(){this.input.addEventListener("keyup",this.onChangeSearchInput.bind(this),!1),this.input.addEventListener("focus",this.onFocusSearchInput.bind(this),!1),this.dropdownContainer.addEventListener("click",this.onClickSuggestionsDropdown.bind(this),!1),this.dropdownContainer.addEventListener("mousemove",this.onMouseMoveSuggestionsDropdown.bind(this),!1),this.ul.addEventListener("click",this.onClickTag.bind(this),!1),document.addEventListener("click",this.onClickCheckFocus.bind(this),!0),this.tagsInput.addEventListener("keydown",this.onSuggestionsKeyboardNavigate.bind(this),!1),this.dropdownContainer.addEventListener("keydown",this.onSuggestionsKeyboardNavigate.bind(this),!1),this.tagsInput.addEventListener("keydown",this.onTagsKeyboardNavigate.bind(this),!1)},storkTagsInput.prototype.updateWidths=function(){this.maxWidth||(this.maxWidth=this.tagsInput.clientWidth),this.input.parentNode.style.width=this.maxWidth+"px"},storkTagsInput.prototype.suggestionsCallback=function(suggestionsArr){if(0===suggestionsArr.length)return void this.dropdownContainer.classList.remove("has-results");for(;this.dropdownContainer.firstChild;)this.dropdownContainer.removeChild(this.dropdownContainer.firstChild);var i,j,groupDiv,groupHeader,itemsList,item,miscElm;for(i=0;i<suggestionsArr.length;i++){for(groupDiv=document.createElement("div"),groupHeader=document.createElement("div"),miscElm=document.createElement("span"),itemsList=document.createElement("ul"),miscElm.appendChild(document.createTextNode(suggestionsArr[i].displayName)),groupHeader.appendChild(miscElm),j=0;j<suggestionsArr[i].items.length;j++)item=document.createElement("li"),item.storkTagsProps={value:suggestionsArr[i].items[j].value,displayName:suggestionsArr[i].items[j].displayName,groupId:suggestionsArr[i].id,groupDisplayName:suggestionsArr[i].displayName},miscElm=document.createElement("a"),miscElm.appendChild(document.createTextNode(suggestionsArr[i].items[j].displayName)),item.appendChild(miscElm),itemsList.appendChild(item);groupDiv.appendChild(groupHeader),groupDiv.appendChild(itemsList),this.dropdownContainer.appendChild(groupDiv)}this.dropdownContainer.storkTagsProps.hoveredLIIndex=null,this.dropdownContainer.classList.add("has-results")},storkTagsInput.prototype.onClickSuggestionsDropdown=function(e){for(var LI=e.target,i=0;!(LI instanceof HTMLDocument)&&"LI"!==LI.tagName.toUpperCase();){if(i++>=2)return;LI=LI.parentNode}this.addTag(LI.storkTagsProps),this.input.value="",this.input.focus(),this.onChangeSearchInput()},storkTagsInput.prototype.onMouseMoveSuggestionsDropdown=function(e){var LI=e.target,i=0;if(!LI||!LI.tagName)return void console.error("event's target is not an HTMLElement");for(;!(LI instanceof HTMLDocument)&&"LI"!==LI.tagName.toUpperCase();){if(i++>=2)return;LI=LI.parentNode}var index=this.dropdownContainer.storkTagsProps.hoveredLIIndex;if(Number.isInteger(index)){var prevHoveredLI=this.dropdownContainer.storkTagsProps.allLIs[index];if(prevHoveredLI===LI)return;prevHoveredLI.classList.remove("focused")}for(i=0;i<this.dropdownContainer.storkTagsProps.allLIs.length;i++)if(LI===this.dropdownContainer.storkTagsProps.allLIs[i]){LI.classList.add("focused"),this.dropdownContainer.storkTagsProps.hoveredLIIndex=i;break}},storkTagsInput.prototype.addTag=function(tagObj){var i;for(i=0;i<this.chosenTags.length;i++)if(tagObj.groupId===this.chosenTags[i].groupId&&tagObj.value===this.chosenTags[i].value)return this.rechooseRemove?this.removeTag(i):!1;var li=document.createElement("li"),xA=document.createElement("a"),textSpan=document.createElement("span"),displayText=this.chosenTagsFormat;displayText=displayText.replace(/@@@/g,tagObj.groupDisplayName),displayText=displayText.replace(/###/g,tagObj.displayName),xA.appendChild(document.createTextNode("Ã—")),textSpan.appendChild(document.createTextNode(displayText)),li.classList.add("tag"),xA.classList.add("remove"),this.chosenTags.push({value:tagObj.value,displayName:tagObj.displayName,groupId:tagObj.groupId,groupDisplayName:tagObj.groupDisplayName,elm:li}),li.appendChild(xA),li.appendChild(textSpan),this.ul.insertBefore(li,this.input.parentNode)},storkTagsInput.prototype.removeTag=function(index){return this.chosenTags[index]?(this.unfocusTags(),this.ul.removeChild(this.chosenTags[index].elm),this.chosenTags.splice(index,1),!0):!1},storkTagsInput.prototype.onClickTag=function(e){var elm=e.target,i=0;do{if("A"===elm.tagName.toUpperCase()&&elm.classList.contains("remove")){var elmIndex=getElementIndex(elm);return this.removeTag(elmIndex),void this.focusSearchInput(0)}if("LI"===elm.tagName.toUpperCase()&&elm.classList.contains("tag"))return void this.onClickFocusTag(elm);elm=elm.parentNode,i++}while(3>=i&&!(elm instanceof HTMLDocument))},storkTagsInput.prototype.onClickFocusTag=function(index){Number.isInteger(index)||(index=getElementIndex(index)),Number.isInteger(this.focusedTagIndex)&&this.chosenTags[this.focusedTagIndex].elm.classList.remove("focused"),this.chosenTags[index].elm.classList.add("focused"),this.focusedTagIndex=index,this.tagsInput.focus()},storkTagsInput.prototype.onClickCheckFocus=function(e){for(var target=e.target;!(target instanceof HTMLDocument)&&target!==this.tagsInput&&target!==this.dropdownContainer;)if(target=target.parentNode,!target)return this.tagsInput.classList.remove("focused"),void this.dropdownContainer.classList.remove("focused");this.tagsInput.classList.add("focused"),this.dropdownContainer.classList.add("focused")},storkTagsInput.prototype.onChangeSearchInput=function(e){this.input.value!==this.lastSearchString&&this.suggestionsHandler(this.input.value,this.suggestionsCallback.bind(this)),this.lastSearchString=this.input.value},storkTagsInput.prototype.onFocusSearchInput=function(e){this.unfocusTags()},storkTagsInput.prototype.onSuggestionsKeyboardNavigate=function(e){var hoveredIndex,allLIs,key=keyboardMap[e.keyCode];"DOWN"!==key&&"UP"!==key&&"ENTER"!==key||(e.preventDefault(),hoveredIndex=this.dropdownContainer.storkTagsProps.hoveredLIIndex,allLIs=this.dropdownContainer.storkTagsProps.allLIs,"DOWN"===key?Number.isInteger(hoveredIndex)&&hoveredIndex!==allLIs.length-1?this.onMouseMoveSuggestionsDropdown({target:allLIs[hoveredIndex+1]}):this.onMouseMoveSuggestionsDropdown({target:allLIs[0]}):"UP"===key?Number.isInteger(hoveredIndex)&&0!==hoveredIndex?this.onMouseMoveSuggestionsDropdown({target:allLIs[hoveredIndex-1]}):this.onMouseMoveSuggestionsDropdown({target:allLIs[allLIs.length-1]}):"ENTER"===key&&Number.isInteger(hoveredIndex)&&this.onClickSuggestionsDropdown({target:allLIs[hoveredIndex]}))},storkTagsInput.prototype.onTagsKeyboardNavigate=function(e){var key=keyboardMap[e.keyCode];"LEFT"===key?this.input===document.activeElement?Number.isInteger(this.focusedTagIndex)||0!==this.input.selectionStart||this.onClickFocusTag(this.chosenTags.length-1):this.focusedTagIndex>0&&(this.onClickFocusTag(this.focusedTagIndex-1),e.preventDefault()):"RIGHT"===key?this.input!==document.activeElement&&(this.focusedTagIndex===this.chosenTags.length-1?(this.unfocusTags(),this.focusSearchInput(0)):Number.isInteger(this.focusedTagIndex)?this.onClickFocusTag(this.focusedTagIndex+1):this.onClickFocusTag(0),e.preventDefault()):"BACKSPACE"!==key&&"DELETE"!==key||(this.input===document.activeElement?(this.tagDeleteThrottle.allowed&&""===this.input.value&&this.removeTag(this.chosenTags.length-1),(""!==this.input.value||this.tagDeleteThrottle.allowed)&&(this.tagDeleteThrottle.allowed=!1,clearTimeout(this.tagDeleteThrottle.TO),this.tagDeleteThrottle.TO=setTimeout(function(){this.tagDeleteThrottle.allowed=!0}.bind(this),400))):Number.isInteger(this.focusedTagIndex)&&(this.removeTag(this.focusedTagIndex),this.focusSearchInput(0),e.preventDefault()))},storkTagsInput.prototype.unfocusSuggestions=function(){if(Number.isInteger(this.dropdownContainer.storkTagsProps.hoveredLIIndex))this.dropdownContainer.storkTagsProps.allLIs[this.dropdownContainer.storkTagsProps.hoveredLIIndex].classList.remove("focused");else for(var i=0;i<this.dropdownContainer.storkTagsProps.allLIs.length;i++)this.dropdownContainer.storkTagsProps.allLIs[i].classList.contains("focused")&&this.dropdownContainer.storkTagsProps.allLIs[i].classList.remove("focused");this.dropdownContainer.storkTagsProps.hoveredLIIndex=null},storkTagsInput.prototype.unfocusTags=function(){if(Number.isInteger(this.focusedTagIndex))this.chosenTags[this.focusedTagIndex].elm.classList.remove("focused");else for(var i=0;i<this.chosenTags.length;i++)this.chosenTags[i].elm.classList.contains("focused")&&this.chosenTags[i].elm.classList.remove("focused");this.focusedTagIndex=null},storkTagsInput.prototype.focusSearchInput=function(caretPosition){Number.isInteger(caretPosition)||(caretPosition=0),this.input.focus();var INP=this.input;setTimeout(function(){INP.setSelectionRange(caretPosition,caretPosition)},0)},root.storkTagsInput=storkTagsInput}(this);
//# sourceMappingURL=tags-input.min.js.map