!function(root){"use strict";var capitalizeWords=function(str){return str.replace(/\w\S*/g,function(txt){return txt.charAt(0).toUpperCase()+txt.substr(1).toLowerCase()})},StorkTagsInput=function(options){this.tagsInput=options.element,this.suggestionsHandler=options.suggestionsHandler,this.rnd||(this.rnd=1e3*(Math.floor(9*Math.random())+1)+Date.now()%1e3),this.inputMinWidth=options.inputMinWidth||60,this.rechooseRemove=options.rechooseRemove||!1,this.placeholder=options.placeholder||"",this.chosenTags=[],this.focusedTagIndex=null,this.lastSearchString="",this.tagDeleteThrottle={allowed:!0,TO:void 0},this.tagsInput.classList.add("stork-tags","stork-tags"+this.rnd),this.tagsInput.setAttribute("tabindex",0),this.buildDom(),this.setEventListeners()};StorkTagsInput.prototype.addEventListener=function(type,listener,options_or_useCapture){this.tagsInput.addEventListener(type,listener,options_or_useCapture)},StorkTagsInput.prototype.buildDom=function(){var ul=document.createElement("ul"),input=document.createElement("input");input.classList.add("search"),input.setAttribute("placeholder",this.placeholder),this.tagsInput.appendChild(ul),this.tagsInput.appendChild(input);var dropdownContainer=document.createElement("div");dropdownContainer.classList.add("stork-tags-dropdown-container","stork-tags-dropdown-container"+this.rnd),dropdownContainer.setAttribute("tabindex",0),this.ul=ul,this.input=input,this.dropdownContainer=dropdownContainer,this.dropdownContainer.storkTagsProps={allLIs:this.dropdownContainer.getElementsByTagName("li"),hoveredLIIndex:null},this.positionDropdown(),document.body.appendChild(dropdownContainer)},StorkTagsInput.prototype.setEventListeners=function(){this.input.addEventListener("keyup",this.onChangeSearchInput.bind(this),!1),this.input.addEventListener("focus",this.onFocusSearchInput.bind(this),!1),this.dropdownContainer.addEventListener("click",this.onClickSuggestionsDropdown.bind(this),!1),this.dropdownContainer.addEventListener("mousemove",this.onMouseMoveSuggestionsDropdown.bind(this),!1),this.ul.addEventListener("click",this.onClickTag.bind(this),!1),document.addEventListener("click",this.onClickCheckFocus.bind(this),!0),this.tagsInput.addEventListener("keydown",this.onSuggestionsKeyboardNavigate.bind(this),!1),this.dropdownContainer.addEventListener("keydown",this.onSuggestionsKeyboardNavigate.bind(this),!1),this.tagsInput.addEventListener("keydown",this.onTagsKeyboardNavigate.bind(this),!1)},StorkTagsInput.prototype.positionDropdown=function(width){width?this.dropdownContainer.style.width=width+"px":this.dropdownContainer.style.width=this.tagsInput.offsetWidth+"px";var coordinates=this.tagsInput.getCoordinates();this.dropdownContainer.style.left=coordinates.x+"px",this.dropdownContainer.style.top=coordinates.y+this.tagsInput.offsetHeight+1+"px"},StorkTagsInput.prototype.suggestionsCallback=function(suggestionsArr){for(;this.dropdownContainer.firstChild;)this.dropdownContainer.removeChild(this.dropdownContainer.firstChild);if(0===suggestionsArr.length)return void this.dropdownContainer.classList.remove("has-results");var i,j,groupDiv,groupHeader,itemsList,item,miscElm;for(i=0;i<suggestionsArr.length;i++){for(groupDiv=document.createElement("div"),groupHeader=document.createElement("div"),miscElm=document.createElement("span"),itemsList=document.createElement("ul"),miscElm.appendChild(document.createTextNode(suggestionsArr[i].label)),groupHeader.appendChild(miscElm),j=0;j<suggestionsArr[i].items.length;j++)item=document.createElement("li"),item.storkTagsProps={value:suggestionsArr[i].items[j].value,label:suggestionsArr[i].items[j].label,groupField:suggestionsArr[i].field,groupLabel:suggestionsArr[i].label},miscElm=document.createElement("a"),miscElm.appendChild(document.createTextNode(suggestionsArr[i].items[j].label)),item.appendChild(miscElm),itemsList.appendChild(item);groupDiv.appendChild(groupHeader),groupDiv.appendChild(itemsList),this.dropdownContainer.appendChild(groupDiv)}this.dropdownContainer.storkTagsProps.hoveredLIIndex=null,this.positionDropdown(),this.dropdownContainer.classList.add("has-results")},StorkTagsInput.prototype.onClickSuggestionsDropdown=function(e){for(var LI=e.target,i=0;!(LI instanceof HTMLDocument)&&"LI"!==LI.tagName.toUpperCase();){if(i++>=2)return;LI=LI.parentNode}this.addTag(LI.storkTagsProps),this.unfocusSuggestions(),this.input.value="",this.input.focus(),this.onFocusSearchInput(),this.onChangeSearchInput()},StorkTagsInput.prototype.onMouseMoveSuggestionsDropdown=function(e){var LI=e.target,i=0;if(!LI||!LI.tagName)return void console.error("event's target is not an HTMLElement");for(;!(LI instanceof HTMLDocument)&&"LI"!==LI.tagName.toUpperCase();){if(i++>=2)return;LI=LI.parentNode}var index=this.dropdownContainer.storkTagsProps.hoveredLIIndex;if(Number.isInteger(index)){var prevHoveredLI=this.dropdownContainer.storkTagsProps.allLIs[index];if(prevHoveredLI===LI)return;prevHoveredLI.classList.remove("focused")}for(i=0;i<this.dropdownContainer.storkTagsProps.allLIs.length;i++)if(LI===this.dropdownContainer.storkTagsProps.allLIs[i]){LI.classList.add("focused"),this.dropdownContainer.storkTagsProps.hoveredLIIndex=i;break}},StorkTagsInput.prototype.addTag=function(tagObj){var i;for(tagObj.groupLabel||(tagObj.groupLabel=capitalizeWords(tagObj.groupField)),tagObj.label||(tagObj.label=capitalizeWords(tagObj.value)),i=0;i<this.chosenTags.length;i++)if(tagObj.groupField===this.chosenTags[i].groupField&&tagObj.value===this.chosenTags[i].value)return this.rechooseRemove?this.removeTag(i):!1;var li=document.createElement("li"),xA=document.createElement("a"),groupSpan=document.createElement("span"),valueSpan=document.createElement("span");xA.appendChild(document.createTextNode("Ã—")),groupSpan.appendChild(document.createTextNode(tagObj.groupLabel)),valueSpan.appendChild(document.createTextNode(tagObj.label)),xA.classList.add("remove"),groupSpan.classList.add("group"),valueSpan.classList.add("value"),this.chosenTags.push({value:tagObj.value,label:tagObj.label,groupField:tagObj.groupField,groupLabel:tagObj.groupLabel,elm:li}),li.appendChild(xA),li.appendChild(groupSpan),li.appendChild(valueSpan),this.ul.appendChild(li);var evnt=new CustomEvent("tag-added",{bubbles:!0,cancelable:!0,detail:{obj:this.chosenTags[this.chosenTags.length-1],index:this.chosenTags.length-1}});this.tagsInput.dispatchEvent(evnt)},StorkTagsInput.prototype.removeTag=function(index){if(this.chosenTags[index]){this.unfocusTags(),this.ul.removeChild(this.chosenTags[index].elm);var removed=this.chosenTags.splice(index,1),evnt=new CustomEvent("tag-removed",{bubbles:!0,cancelable:!0,detail:{obj:removed[0],index:index}});return this.tagsInput.dispatchEvent(evnt),!0}return!1},StorkTagsInput.prototype.removeAllTags=function(){if(this.unfocusTags(),!this.ul.firstChild)return!1;for(;this.ul.firstChild;)this.ul.removeChild(this.ul.firstChild);var removed=this.chosenTags.splice(0,this.chosenTags.length),evnt=new CustomEvent("all-tags-removed",{bubbles:!0,cancelable:!0,detail:{removedTags:removed}});return this.tagsInput.dispatchEvent(evnt),!0},StorkTagsInput.prototype.onClickTag=function(e){var elm=e.target,i=0;do{if("A"===elm.tagName.toUpperCase()&&elm.classList.contains("remove")){var elmIndex=elm.parentNode.index;return this.removeTag(elmIndex),void this.focusSearchInput(0)}if("LI"===elm.tagName.toUpperCase())return void this.onClickFocusTag(elm);elm=elm.parentNode,i++}while(3>=i&&!(elm instanceof HTMLDocument))},StorkTagsInput.prototype.onClickFocusTag=function(index){Number.isInteger(index)||(index=index.index),Number.isInteger(this.focusedTagIndex)&&this.chosenTags[this.focusedTagIndex].elm.classList.remove("focused"),this.chosenTags[index].elm.classList.add("focused"),this.focusedTagIndex=index,this.tagsInput.focus();var liStyle=this.chosenTags[index].elm.currentStyle||window.getComputedStyle(this.chosenTags[index].elm),marginLeft=parseInt(liStyle.marginLeft);this.tagsInput.scrollLeft=Math.min(this.chosenTags[index].elm.offsetLeft-marginLeft,this.tagsInput.clientWidth),this.input.style.right=-this.tagsInput.scrollLeft+"px"},StorkTagsInput.prototype.onClickCheckFocus=function(e){for(var target=e.target;!(target instanceof HTMLDocument)&&target!==this.tagsInput&&target!==this.dropdownContainer;)if(target=target.parentNode,target&&target instanceof HTMLDocument)return this.tagsInput.classList.remove("focused"),void this.dropdownContainer.classList.remove("focused");this.tagsInput.classList.add("focused"),this.dropdownContainer.classList.add("focused")},StorkTagsInput.prototype.onChangeSearchInput=function(e){this.input.value!==this.lastSearchString&&this.suggestionsHandler(this.input.value,this.chosenTags,this.suggestionsCallback.bind(this)),this.lastSearchString=this.input.value},StorkTagsInput.prototype.onFocusSearchInput=function(e){this.unfocusTags(),console.log(this.tagsInput.clientWidth),this.tagsInput.scrollLeft=this.tagsInput.clientWidth,console.log(this.tagsInput.clientWidth)},StorkTagsInput.prototype.onSuggestionsKeyboardNavigate=function(e){var hoveredIndex,allLIs,key=keyboardMap[e.keyCode];0!==this.dropdownContainer.storkTagsProps.allLIs.length&&this.dropdownContainer.classList.contains("focused")&&("DOWN"!==key&&"UP"!==key&&"ENTER"!==key||(e.preventDefault(),hoveredIndex=this.dropdownContainer.storkTagsProps.hoveredLIIndex,allLIs=this.dropdownContainer.storkTagsProps.allLIs,"DOWN"===key?Number.isInteger(hoveredIndex)&&hoveredIndex!==allLIs.length-1?this.onMouseMoveSuggestionsDropdown({target:allLIs[hoveredIndex+1]}):this.onMouseMoveSuggestionsDropdown({target:allLIs[0]}):"UP"===key?Number.isInteger(hoveredIndex)&&0!==hoveredIndex?this.onMouseMoveSuggestionsDropdown({target:allLIs[hoveredIndex-1]}):this.onMouseMoveSuggestionsDropdown({target:allLIs[allLIs.length-1]}):"ENTER"===key&&(Number.isInteger(hoveredIndex)?this.onClickSuggestionsDropdown({target:allLIs[hoveredIndex]}):this.onMouseMoveSuggestionsDropdown({target:allLIs[0]}))))},StorkTagsInput.prototype.onTagsKeyboardNavigate=function(e){var key=keyboardMap[e.keyCode];"LEFT"===key?this.input===document.activeElement?Number.isInteger(this.focusedTagIndex)||0!==this.input.selectionStart||this.onClickFocusTag(this.chosenTags.length-1):this.focusedTagIndex>0&&(this.onClickFocusTag(this.focusedTagIndex-1),e.preventDefault()):"RIGHT"===key?this.input!==document.activeElement&&(this.focusedTagIndex===this.chosenTags.length-1?(this.unfocusTags(),this.focusSearchInput(0)):Number.isInteger(this.focusedTagIndex)?this.onClickFocusTag(this.focusedTagIndex+1):this.onClickFocusTag(0),e.preventDefault()):"BACKSPACE"!==key&&"DELETE"!==key||(this.input===document.activeElement?(this.tagDeleteThrottle.allowed&&""===this.input.value&&this.removeTag(this.chosenTags.length-1),(""!==this.input.value||this.tagDeleteThrottle.allowed)&&(this.tagDeleteThrottle.allowed=!1,clearTimeout(this.tagDeleteThrottle.TO),this.tagDeleteThrottle.TO=setTimeout(function(){this.tagDeleteThrottle.allowed=!0}.bind(this),400))):Number.isInteger(this.focusedTagIndex)&&(this.removeTag(this.focusedTagIndex),this.focusSearchInput(0),e.preventDefault()))},StorkTagsInput.prototype.unfocusSuggestions=function(){if(Number.isInteger(this.dropdownContainer.storkTagsProps.hoveredLIIndex))this.dropdownContainer.storkTagsProps.allLIs[this.dropdownContainer.storkTagsProps.hoveredLIIndex].classList.remove("focused");else for(var i=0;i<this.dropdownContainer.storkTagsProps.allLIs.length;i++)this.dropdownContainer.storkTagsProps.allLIs[i].classList.contains("focused")&&this.dropdownContainer.storkTagsProps.allLIs[i].classList.remove("focused");this.dropdownContainer.storkTagsProps.hoveredLIIndex=null},StorkTagsInput.prototype.unfocusTags=function(){if(Number.isInteger(this.focusedTagIndex))this.chosenTags[this.focusedTagIndex].elm.classList.remove("focused");else for(var i=0;i<this.chosenTags.length;i++)this.chosenTags[i].elm.classList.contains("focused")&&this.chosenTags[i].elm.classList.remove("focused");this.focusedTagIndex=null},StorkTagsInput.prototype.focusSearchInput=function(caretPosition){Number.isInteger(caretPosition)||(caretPosition=0),this.input.focus();var INP=this.input;setTimeout(function(){INP.setSelectionRange(caretPosition,caretPosition)},0)},root.StorkTagsInput=StorkTagsInput}(window);
//# sourceMappingURL=tags-input.min.js.map